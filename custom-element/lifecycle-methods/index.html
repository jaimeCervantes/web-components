<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Web components: Lifecycle methods</title>
</head>
<body>
	<style>
		mi-mensaje {
			display: block;
			border: 3px solid red;
		}
	</style>

	<mi-mensaje msj="Mi mensaje"></mi-mensaje>
	<mi-mensaje msj="Mi mensaje" casi-visible></mi-mensaje>

	<script>
		class MiMensaje extends HTMLElement {

			// Usado para setear estado o valores default del elemento, crear shadow DOM y agregar eventos
			constructor() {
				super();
				console.log('constructor: cuando el elemento es creado');
			}

			static get observedAttributes() {
				return ['msj', 'casi-visible'];
			}

			// Este callback se ejecuta cada vez que se cambia un atributo listado en listados en observedAttributes, si la funcion "set"
			// de una propiedad tambien modifica el atributo listado, tambien se ejecuta
			attributeChangedCallback(attrName, oldValue, newValue) {
				if (attrName === 'msj') {
					this.innerHTML = newValue;
				}

				if (attrName === 'casi-visible') {
					this.setCasiVisible();
				}

				console.log('attributeChangedCallback: cuando cambia un atributo');
			}

			// Se ejecuta cuando el elemento es insertado en el DOM, se utiliza para codigo que hace
			// peticiones a servicios, acceder a elementos del shadow DOM y para renderizar HTML,
			// la mayoria del trabajo inicial debera estar aqui, p
			connectedCallback () {
				console.log('connectedCallback: cuando el elemento es insertado en el DOM');
			}

			// Se ejecuta cuando el elemento es elimando del arbol del DOM, util para codigo de limpieza
			// como eliminar listeners o items del localStorage relacionados a este elemento
			disconnectedCallback () {
				console.log('disconnectedCallback: cuando el elemento es eliminado del DOM');
			}

			setCasiVisible() {
				if (this.casiVisible) {
					this.style.opacity = 0.3;
					return;
				}
				
				this.style.opacity = 1;
			}

			get msj () {
				return this.getAttribute('msj');
			}

			set msj (value) {
				this.setAttribute('msj', value);
			}

			get casiVisible () {
				return this.hasAttribute('casi-visible');
			}

			set casiVisible (value) {
				if (value) {
					this.setAttribute('casi-visible', '');
					return;
				}

				this.removeAttribute('casi-visible');
			}
		}

		// console.log(MiMensaje.observedAttributes);
		customElements.define('mi-mensaje', MiMensaje);
	</script>
</body>
</html>